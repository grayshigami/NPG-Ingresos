import z from"./registrar-incidencia-Bgu7UoJa.js";import A from"./editar-incidencia-Dp5HWtos.js";import{c as b,E as F}from"./jspdf.es.min-Dj0cXDGD.js";import{a as D,i as C,_ as B}from"./logo-negro-Sinfondo-DYJ1N-ui.js";import{_ as N,r as v,c as E,a as n,t as m,b as y,w as H,v as R,e as V,F as q,f as L,g as P,d as w,o as S}from"./index-BF6LzyhM.js";import"./_commonjsHelpers-C4iS2aBk.js";const J={name:"pantalla-usuario",components:z,EditarIncidencia:A,data(){return{name:"",userId:"",incidencias:[],selectedDate:new b.Date().toISOString().substring(0,10),filteredIncidencias:[],editingIncidenciaId:null,isUser:!1}},mounted(){this.fetchIncidencias()},created(){this.name=localStorage.getItem("name"),this.userId=localStorage.getItem("user_id"),this.checkUser()},methods:{async fetchIncidencias(){try{const e=await D.get(`https://${C}:7207/api/Incidencia`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});this.incidencias=e.data,console.log(this.incidencias),this.filterIncidencias()}catch(e){console.error(e)}},filterIncidencias(){this.filteredIncidencias=this.incidencias.filter(e=>e.horaEntrada.substring(0,10)==this.selectedDate)},formatDate(e){return new b.Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},editIncidencia(e){this.$router.push({name:"editar-incidencia",query:{incidencia:e.id}})},async agregarElemento(e){this.incidencias.push(e)},async eliminarElemento(e){try{const t=await D.delete(`https://${C}:7207/api/Incidencia/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("Incidencia eliminada:",t.data),this.fetchIncidencias()}catch(t){console.error("Error deleting element:",t)}},checkUser(){localStorage.getItem("user_type")==0?this.isUser=!0:this.$router.push("/pantalla-administrador")},logout(){localStorage.removeItem("token"),window.location.href="/login-component"},exportToPDF(){const e=new F("p","pt","a4"),t="Tabla de incidencias",d=40,g=20,a=105,o=6,s=2;let p=1;const i=new b.Date,h=i.toLocaleDateString(),k=i.toLocaleTimeString();e.setFontSize(18),e.text(t,d,40),e.setFontSize(10),e.text(`Fecha: ${h} ${k}`,d,60),e.text(p.toString(),d,e.internal.pageSize.getHeight()-10);const x=document.getElementById("table-export");if(!x){console.error("No se encontro el elemento con ID table-export");return}const U=Array.from(x.querySelectorAll("th")).map(c=>c.innerText),_=Array.from(x.querySelectorAll("tbody tr")).map(c=>Array.from(c.querySelectorAll("td")).map(r=>r.innerText));let l=90;e.setFontSize(10),U.forEach((c,r)=>{if(r+1!=o){const u=d+(r-(r>=o?1:0))*a;e.text(c,u+s,l+s),e.rect(u-2,l-12,a,g)}}),l+=g,_.forEach(c=>{let r=g;c.forEach((u,f)=>{if(f+1!=o){const I=e.splitTextToSize(u,a-2*s).length*g;I>r&&(r=I)}}),c.forEach((u,f)=>{if(f+1!=o){const T=d+(f-(f>o?1:0))*a,I=e.splitTextToSize(u,a-2*s);e.text(I,T+s,l+s),e.rect(T-2,l-12,a,r)}}),l+=r,l>e.internal.pageSize.getHeight()-40&&(e.addPage(),l=90,p++)}),e.text(p.toString(),d,e.internal.pageSize.getHeight()-10),e.save(`Tabla_${h}_${k}.pdf`)},goToEdit(){this.$router.push("/editar-incidencia")},goToIncidencia(){this.$router.push("/registrar-incidencia")},goToContrasena(){this.$router.push("/cambiar-contrasena")}}},M={key:0},O={class:"general"},W={class:"toolbar"},Y={class:"b-user"},j={class:"screen-data"},G={class:"table-data"},K={id:"table-export"},Q={class:"comm"},X=["onClick"],Z=["onClick"];function $(e,t,d,g,a,o){const s=v("RegistrarIncidencia"),p=v("EditarIncidencia");return a.isUser?(S(),E("div",M,[n("div",O,[n("div",W,[t[7]||(t[7]=n("img",{src:B,alt:"",width:"10%",height:"10%"},null,-1)),n("h2",Y,"Bienvenido "+m(a.name),1),t[8]||(t[8]=n("div",{class:"spacer"},null,-1)),n("button",{onClick:t[0]||(t[0]=(...i)=>o.logout&&o.logout(...i))},t[6]||(t[6]=[n("i",{class:"fa-solid fa-power-off"},null,-1),y(" Cerrar sesión ")]))]),n("div",j,[H(n("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>a.selectedDate=i),onChange:t[2]||(t[2]=(...i)=>o.filterIncidencias&&o.filterIncidencias(...i))},null,544),[[R,a.selectedDate]]),n("button",{onClick:t[3]||(t[3]=(...i)=>o.goToIncidencia&&o.goToIncidencia(...i))},t[9]||(t[9]=[n("i",{class:"fa-solid fa-plus"},null,-1),y(" Registrar incidencia ")])),n("button",{onClick:t[4]||(t[4]=(...i)=>o.exportToPDF&&o.exportToPDF(...i))},t[10]||(t[10]=[n("i",{class:"fa-solid fa-file-export"},null,-1),y(" Exportar ")])),n("button",{onClick:t[5]||(t[5]=(...i)=>o.goToContrasena&&o.goToContrasena(...i))},"Cambiar contraseña")]),V(s,{onNuevoElemento:o.agregarElemento,userId:a.userId},null,8,["onNuevoElemento","userId"]),n("div",G,[n("table",K,[t[13]||(t[13]=n("thead",null,[n("tr",null,[n("th",null,"Nombre"),n("th",null,"Empresa"),n("th",null,"Entrada"),n("th",null,"Salida"),n("th",null,"Comentario"),n("th",null,"Acciones")])],-1)),n("tbody",null,[(S(!0),E(q,null,L(a.filteredIncidencias,i=>(S(),E("tr",{key:i.id},[n("td",null,m(i.nombre),1),n("td",null,m(i.empresa),1),n("td",null,m(o.formatDate(i.horaEntrada)),1),n("td",null,m(i.horaSalida?o.formatDate(i.horaSalida):null),1),n("td",Q,m(i.comentario),1),n("td",null,[n("button",{onClick:h=>o.editIncidencia(i)},t[11]||(t[11]=[n("i",{class:"fa-solid fa-pencil"},null,-1)]),8,X),n("button",{onClick:h=>o.eliminarElemento(i.id)},t[12]||(t[12]=[n("i",{class:"fa-solid fa-trash"},null,-1)]),8,Z)])]))),128))])]),a.editingIncidenciaId!==null?(S(),P(p,{key:0,incidenciaId:a.editingIncidenciaId,onIncidenciaUpdated:e.onIncidenciaUpdated},null,8,["incidenciaId","onIncidenciaUpdated"])):w("",!0)])])])):w("",!0)}const re=N(J,[["render",$]]);export{re as default};
